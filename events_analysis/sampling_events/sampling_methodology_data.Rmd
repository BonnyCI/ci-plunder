---
title: "Sampling Methodlogy Data"
output: html_notebook
---

```{r}
library(dplyr)
library(bigrquery)

project <- "bonnyci-github-archive"
```

# Experiments

## Overview

```{r}
# TODO time period summary by event type - number of events, number of repos, number of actors, number of independent repos (not part of same user/org)
```


## All Events

### Random Sample of Events
```
SELECT *, rand() as rand
  FROM [bonnyci-github-archive:ci_plunder_repo_samples.2017_02_03_21]
  order by rand
  limit 100
```

```{r}
all_repo_data_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_all.repo_data_trimmed]'

all_repo_data <- query_exec(all_repo_data_sql, project = project)

saveRDS(all_repo_data, "all_repo_data.rds")

```

### Repo Owner Frequency
How many repos came from the same owner?

```{r}
all_repo_data_owners_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_all.repo_data_owners]'

all_repo_data_owners <- query_exec(all_repo_data_owners_sql, project = project)

all_repo_data <- merge(all_repo_data_owners, all_repo_data, by="repo_owner")

saveRDS(all_repo_data, "all_repo_data.rds")
```

### Repo Age
How old are the repos in the sample? How recently were they last updated?

```{r}
all_repo_data_age_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_all.repo_data]'

all_repo_data_age <- query_exec(all_repo_data_age_sql, project = project)

all_repo_data <- merge(x=all_repo_data_age, y=all_repo_data, by.x="repo_name", by.y="repo_slug")

saveRDS(all_repo_data, "all_repo_data.rds")
```

### Actors per Repo
How many unique actors did each repo have?

### Actors per Event Type per Repo
How many unique actors did each event type in each repo have?

### Events per Actor Percent Frequency
How are events distributed among actors in the repository?

### Repos per Actor in Sample
How many separate repos did actors in the sample contribute to? Did any actors contribute across samples?

### Repo Language Frequency
What languages were represented in the repositories? What proportion of the repository's code was in that language?

### Build Status in Readme
What proportion of repos had a README detected by Github? Of those, how many had a Build status tag (indicates possible CI)?

## Create Events

### Random Sample of Events

```
SELECT *, rand() as rand
  FROM [bonnyci-github-archive:ci_plunder_repo_samples.2017_02_03_21]
  where type == "CreateEvent"
  order by rand
  limit 100
```

```{r}
create_repo_data_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_create.repo_data]'

create_repo_data <- query_exec(create_repo_data_sql, project = project)

saveRDS(create_repo_data, "create_repo_data.rds")
```

## Fork Events

### Random Sample of Events
```
SELECT *, rand() as rand
  FROM [bonnyci-github-archive:ci_plunder_repo_samples.2017_02_03_21]
  where type == "ForkEvent"
  order by rand
  limit 100
```

```{r}
fork_repo_data_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_fork.repo_data]'

fork_repo_data <- query_exec(fork_repo_data_sql, project = project)

saveRDS(fork_repo_data, "fork_repo_data.rds")
```

## Push Events

### Random Sample of Events

```
SELECT *, rand() as rand
  FROM [bonnyci-github-archive:ci_plunder_repo_samples.2017_02_03_21]
  where type == "PushEvent"
  order by rand
  limit 100
```

```{r}
push_repo_data_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_push.repo_data]'

push_repo_data <- query_exec(push_repo_data_sql, project = project)

saveRDS(push_repo_data, "push_repo_data.rds")
```

## Release Events

### Random Sample of Events

```
SELECT *, rand() as rand
  FROM [bonnyci-github-archive:ci_plunder_repo_samples.2017_02_03_21]
  where type == "ReleaseEvent"
  order by rand
  limit 100
```

```{r}
release_repo_data_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_release.repo_data]'

release_repo_data <- query_exec(release_repo_data_sql, project = project)

saveRDS(release_repo_data, "release_repo_data.rds")
```

## Watch Events

### Random Sample of Events

```
SELECT *, rand() as rand
  FROM [bonnyci-github-archive:ci_plunder_repo_samples.2017_02_03_21]
  where type == "WatchEvent"
  order by rand
  limit 100
```
```{r}
watch_repo_data_sql <-
  'select * from [bonnyci-github-archive:ci_plunder_repo_samples_watch.repo_data]'

watch_repo_data <- query_exec(watch_repo_data_sql, project = project)

saveRDS(watch_repo_data, "watch_repo_data.rds")
```