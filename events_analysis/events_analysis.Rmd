---
title: "Participation Rates of GitHub Projects"
output:
  html_document: default
  html_notebook: default
---

<h2>Problems</h2>

The ultimate goal of this research is to identify projects on GitHub that would most likely benefit from Continuous Integration. A side goal of this research is to better understand what activity data alone can potentially tell us about GitHub projects. Is it possible to divide Github projects into similar groupings based on just activity data?

The activity data are collected by the Github Archive project which keeps a massive archive of the public event stream available through the Github API. This data is very easy to collect, the GitHub Archive project updates it regularly, and it's accessible as a public data set on Google BigQuery. Data about specific GitHub projects is much harder to collect and more complicated to process.

Github is huge. There are a lot of projects hosted on GitHuch and a lot of variability that make analyis very challenging. Events data allows us to easily filter out currently active projects simply by looking at events within a recent timeframe. Grouping GitHub projects into more easily studyable strata with less variation solely based on events data would be a simple and reliable solution to a very complicated problem. Even if the groups need to be further stratified, casting an initial net would greatly reduce the time and effort required to study this population. 

<h2>Hypotheses</h2>

A participation rate that compares a ratio of events per actor to total events across projects provides a sufficient means for grouping such that the resulting strata have sufficiently reduced variability to allow apples-to-apples comparisons within those strata.

A secondary hypothesis is that random samples created solely based on event types occuring at different frequencies for projects of different participation rates will result in a higher proportion of projects with the participation rate for which that type of event occurred most frequently. For example, if we are most interested in studying high participation projects, a sample built from one type of event that occurred more frequently for high participation projects and less frequently for low participation projects should contain more high participation projects than low participation projects.

<h2>Null Hypothesis</h2>

Grouping projects by participation rate does not reduce variability sufficiently for apples-to-apples project comparisons. 

<h2>Methodology</h2>

This research analyzed 6 months of GitHub activity published in the GitHub Archive, from June 2016 to December 2016. For data set creation, see the accompanying file, "events_analysis_data.Rmd".


```{r}
library(dplyr)
library(ggplot2)
library(reshape2)
```


<h2>Event Frequency</h2>


<h3>How many public GitHub events occurred for each month?</h3>

The overall distribution is very slightly left skewed with an increase in event activity in November and a sudden decrease in December. 

```{r}

event_totals <- readRDS("event_totals.rds")

ggplot(data = event_totals, aes(x = factor(month, levels = month.abb), y = num_events, fill = I("blue"))) +
  geom_bar(stat="identity") +
  ylab("Number of Events") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

<h3>How many unique contributors and repositories generated these events?</h3>

The shape of these two variables is consistent with the shape of the event frequency, which is expected because these are all dependent. What's particularly interesting is the huge gaps between the number of events, the number of projects, and the number of actors.

```{r}

ggplot(data = event_totals, aes(x=factor(month, levels = month.abb))) +
  geom_line(aes(y = num_repos, colour = "num_repos"), stat="identity", group=1) +
  geom_point(aes(y = num_repos, colour = "num_repos"), stat="identity", group=1) +
  geom_line(aes(y = num_actors, colour = "num_actors"), stat="identity", group=1) + 
  geom_point(aes(y = num_actors, colour = "num_actors"), stat="identity", group=1) +
  xlab("Month") +
  ylab("Count") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

Here's a visual with events just to get some idea of the scale of the activity. This is a huge gap.

```{r}

ggplot(data = event_totals, aes(x=factor(month, levels = month.abb))) +
  geom_line(aes(y = num_events, colour = "num_events"), stat="identity", group=1) +
  geom_point(aes(y = num_events, colour = "num_events"), stat="identity", group=1) +
  geom_line(aes(y = num_repos, colour = "num_repos"), stat="identity", group=1) +
  geom_point(aes(y = num_repos, colour = "num_repos"), stat="identity", group=1) +
  geom_line(aes(y = num_actors, colour = "num_actors"), stat="identity", group=1) + 
  geom_point(aes(y = num_actors, colour = "num_actors"), stat="identity", group=1) +
  xlab("Month") +
  ylab("Count") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```


<h3>What proportion of the events were represented by each type?</h3>

Event types represent different types of activity that occur in each project. The top 4 events that occurred overall are PushEvent, CreateEvent, IssueCommentEvent, and WatchEvent. This is also consistent when looking at month by month activity.

A PushEvent occurs when someone publishes a change to a branch. A CreateEvent occurs when someone creates a new project. An IssueCommentEvent occurs when someone comments on an issue. This can either be a contributor or an end user. A WatchEvent occurs when someone subscribes to updates for a project.

<h4>Event Type Frequency for All Months</h4>

```{r}
event_type_totals_all <- readRDS("event_type_totals.rds")

event_type_totals_all$type <- factor(event_type_totals_all$type, 
  levels = unique(event_type_totals_all$type[order(event_type_totals_all$num_events, decreasing=TRUE)]))

ggplot(data = event_type_totals_all, aes(x=type, y=num_events, fill=type)) +
  geom_bar(stat="identity") +
  theme(legend.position="none") +
  ylab("Number of Events") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

```{r}
event_type_totals <- event_type_totals_all %>%
  filter(type == "PushEvent" |
           type == "CreateEvent" |
           type == "IssueCommentEvent" |
           type == "WatchEvent" |
           type == "PullRequestEvent" |
           type == "IssuesEvent" |
           type == "ForkEvent")

event_type_totals$type <- factor(event_type_totals$type, 
  levels = unique(event_type_totals$type[order(event_type_totals$num_events, decreasing=TRUE)]))

ggplot(data = event_type_totals, aes(x=type, y=num_events, fill=type)) +
  geom_bar(stat="identity") +
  theme(legend.position="none") +
  ylab("Number of Events") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

<h4>Event Type Frequency Across Each Month</h4>

This is the distribution of all event types. There are a lot of event types represented here and about half of them are less frequent. I'll be working with a filtered set that focuses on the most frequent event types.


```{r}
month_event_type_totals_all <- readRDS("month_event_type_totals.rds")

month_event_type_totals_all$type <- factor(month_event_type_totals_all$type, 
   levels = unique(month_event_type_totals_all$type[order(month_event_type_totals_all$num_events, decreasing=TRUE)]))

ggplot(data = month_event_type_totals_all, 
       aes(x = factor(month, levels = month.abb), 
           y = num_events, 
           fill=type)) +
  geom_bar(stat="identity", position="stack") +
  ylab("Number of Events") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
```

```{r}
month_event_type_totals <- month_event_type_totals_all %>% 
  filter(type == "PushEvent" |
           type == "CreateEvent" |
           type == "IssueCommentEvent" |
           type == "WatchEvent" |
           type == "PullRequestEvent" |
           type == "IssuesEvent" |
           type == "ForkEvent")

month_event_type_totals$type <- factor(month_event_type_totals$type, 
   levels = unique(month_event_type_totals$type[order(month_event_type_totals$num_events, decreasing=TRUE)]))

ggplot(data = month_event_type_totals, 
       aes(x = factor(month, levels = month.abb), 
           y = num_events, 
           fill=type)) +
  geom_bar(stat="identity", position="stack") +
  ylab("Number of Events") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
        
```

<h3>How many unique contributors and unique projects are represented in each type of event?</h3>

The charts below are sorted in by event frequency so they are more easily compared with the event type frequency chart above. There is overlap on some of these variables but at this scale it's difficult to see how much. I calculated ratios to make more sense of the overall event type distribution, represented in the last two visuals in this section.

<h4>Actors and Projects Per Event Type</h4>
```{r}

event_type_totals$type <- factor(event_type_totals$type, 
  levels = unique(event_type_totals$type[order(event_type_totals$num_events, decreasing=TRUE)]))

event_type_totals_long <- melt(event_type_totals)

event_type_totals_actor_vs_repo <- event_type_totals_long %>%
  filter(variable == "num_actors" | variable == "num_repos")

ggplot(data = event_type_totals_actor_vs_repo, aes(x=type, y=value, fill=variable))+
  geom_bar(stat="identity", position="dodge") +
  xlab("Event Type") +
  ylab("Count") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

<h4>Actors and Events per Event Type</h4>
```{r}

event_type_totals_actor_vs_events <- event_type_totals_long %>%
  filter(variable == "num_actors" | variable == "num_events")

ggplot(data = event_type_totals_actor_vs_events, aes(x=type, y=value, fill=variable)) +
  geom_bar(stat="identity", position="dodge") +
  xlab("Event Type") +
  ylab("Count") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

<h4>Projects and Events per Event Type</h4>
```{r}
event_type_totals_repos_vs_events <- event_type_totals_long %>%
  filter(variable == "num_repos" | variable == "num_events")

ggplot(data = event_type_totals_repos_vs_events, aes(x=type, y=value, fill=variable)) +
  geom_bar(stat="identity", position="dodge") +
  xlab("Event Type") +
  ylab("Count") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

<h4>Events Per Actor</h4>
These are sorted by most frequent overall event type. A high events-to-actor ratio suggests the event type only represents the activity of a small group of individuals. A smaller events-to-actor ratio suggests the event type is spread across a larger number of individuals.
```{r}

ggplot(data = event_type_totals, aes(x=type, y=events_to_actor, fill=type)) +
  geom_bar(stat="identity") +
  theme(legend.position="none") +
  ylab("Events per Actor") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


<h4>Actors per Project</h4>
These are sorted by most frequent overall event type. A high actors-to-repository ratio suggests the event type represents the activity of a large group of individuals associating with a smaller number of repositories. A smaller actors-to-repository ratio suggests the event type is spread across a smaller number of individuals associating with a larger number of repositories. This ratio could be a clue as to what types of events occur more frequently with projects that have a larger number of contributors.

```{r}

ggplot(data = event_type_totals, aes(x=type, y=actors_to_repo, fill=type)) +
  geom_bar(stat="identity") +
  theme(legend.position="none") +
  ylab("Actors per Project") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

<h4>Events per Actor vs Actors per Project</h4>

This is just an overlay of the two ratios to see how they compare for each event type. If projects with more contributors should have a high actors to project ratio and a low events to actor ratio, then the event types that would indicate higher participation levels would be the WatchEvent and ForkEvent types. Lower participation levels, meaning projects that have a smaller number of contributors, see to be indicated by the PushEvent type. The IssueEvent and IssueComment event types are interesting in that they seem to hover right in the middle with their values being pretty close. We should look at the distribution of event types and these ratios plotted over the full 6 months to see if there is a lot of variation from month to month.

```{r}
event_type_totals_ratios <- event_type_totals_long %>%
  filter(variable == "actors_to_repo" | variable == "events_to_actor")

ggplot(data = event_type_totals_ratios, aes(x=type, y=value, fill=variable)) +
  geom_bar(stat="identity", position="dodge") +
  xlab("Event Type") +
  ylab("Ratio") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

<h3>How much variation do we see in the projects and actors associated with these events each month?</h3>

In other words, is the overall pattern for the 6 month period consistent or is there a lot of variation in who is doing what from month to month? When we look at the total numbers, there's some variabilitity over the 6 month period for the actors and projects with Push events and Create events. The rest of the events have less variability in number of projects and slight variability in number of actors. When looking at ratios of events to actors and actors to projects, we see no variability except for one dip in Push events. 

<h4>Projects Per Month</h4>
```{r}
ggplot(data = month_event_type_totals, 
       aes(x=factor(month, levels = month.abb), 
       y=num_repos, 
       fill=type, 
       colour=type,
       group=type)) +
  geom_line(stat="identity") + 
  geom_point(stat="identity") +
  xlab("Month") +
  ylab("Number of Projects") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
```


<h4>Actors Per Month</h4>

```{r}

ggplot(data = month_event_type_totals, 
       aes(x=factor(month, levels = month.abb), 
       y=num_actors, 
       fill=type, 
       colour=type,
       group=type)) +
  geom_line(stat="identity") + 
  geom_point(stat="identity") +
  xlab("Month") +
  ylab("Number of Actors") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

<h4>Events per Actor</h4>

TODO: these were rounded too aggressively

```{r}

ggplot(data = month_event_type_totals, 
       aes(x=factor(month, levels = month.abb), 
       y=events_to_actor, 
       fill=type, 
       colour=type,
       group=type)) +
  geom_line(stat="identity") + 
  geom_point(stat="identity") +
  xlab("Month") +
  ylab("Events per Actor") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

<h4>Actors per Project</h4>
```{r}

ggplot(data = month_event_type_totals, 
       aes(x=factor(month, levels = month.abb), 
       y=actors_to_repo, 
       fill=type, 
       colour=type,
       group=type)) +
  geom_line(stat="identity") + 
  geom_point(stat="identity") +
  xlab("Month") +
  ylab("Events per Actor") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```


<h2>Measuring Participation</h2>

In the previous section, I identified types of events that occurred more frequently than others. However the total number of actors as well as the actors to project ratio suggest these events may be associated with projects that have a small number of contributors. In this section, I'll explore measuring project participation and grouping projects by this participation rating.

The projects represented by the GitHub event data vary significantly. Some have only 1 or 2 contributors while others have several hundred. A normalized metric is required to effectively compare these repositories. The average percent of events per actor can provide a way to group projects by a comparable participation level.

percent of events per actor = events per actor / total number of events
where events per actor = total number of events/total number of unique actors

For example, for a total of 100 events:
1 unique actor = (100/1)/100 = 1 or 100% of events per actor
2 unique actors = (100/2)/100 = .5 or 50% of events per actor
5 unique actors = (100/5)/100 = .2 or 20% of events per actor
100 unique actors = (100/100)/100 = .01 1% of events per actor
Lower value = higher participation level

I rounded to one decimal place to make the Participation Rate discrete rather than continous. Because of this rounding, repositories that fell into the rating of 0 and 1 had a significantly higher frequency than repositories that fell in to .1 through .5. To adjust for this, I defined 3 levels of Participation: High (0), Medium (.1-.5), and Low (1).

Future iterations of this research may require me to divide the Medium partipation level even further if a lot of variation is observed further down the analysis pipeline. For the purposes of this research, however, a single Medium category should be sufficient.

<h3>How do projects in each participation level compare to each other?</h3>

The following are scatterplots that look at the number of actors, events, events to actors ratio and the number of projects for each distribution level to see if there is a lot of variation or if they follow a steady pattern. As shown below, the distributions are consistently right skewed. While this shows some outlier activity, the fact that the shapes are consistent suggests

In some cases, grouping by frequency produced very few results and in other cases it produced a lot. In order to compare each frequency, I made consistent tiers for each grouping although it does obscure some activity at a smaller scale. Further analysis could look at these segements but given the scale of this initial exploration just the larger trend is sufficient.

The distribution of actors and events across the three participation levels is consistent. As we look at each participation level, the bulk of the number of projects that have higher numbers of actors and numbers of events moves to the next tier to the right. Based on these visualizations, for the purposes of this research, the Low, Middle, and High participation levels do represent a consistent pattern across the event population.

The bottom plot shows a comparison of events for each participation level. I thought that was interesting because you see there how the low participation projects with just one event per project really skew the overall event distribution. The previous sections that explored event type distribution indicated the most frequent events are Push and Create events, and when we look at the number of actors per number of projects generating these events, the ratio is pretty small. That suggests the high number of Push and Create events represent single actors working with a single project. We will do further analysis in the following sections to compare event types with the participation levels to prove this out.


<h4>Low Participation</h4>

All projects in this tier only had one actor, therefore the events-to-actor ratio is exactly the same as the events frequency. I used a jitter point because these overlap.

```{r}
# TODO move this to the data notebook

low_participation_num_actors_freq <- readRDS("low_participation_num_actors_freq.rds")
low_participation_num_actors_freq <- low_participation_num_actors_freq %>%
  mutate(group = actors_group, freq = actor_freq, dataset = "actors") %>%
  select(group, freq, dataset)

low_participation_num_events_freq <- readRDS("low_participation_num_events_freq.rds")
low_participation_num_events_freq <- low_participation_num_events_freq %>%
  mutate(group = events_group, freq = events_freq, dataset = "events") %>%
  select(group, freq, dataset)

low_participation_events_to_actor_freq <- readRDS("low_participation_events_to_actor_freq.rds")
low_participation_events_to_actor_freq <- low_participation_events_to_actor_freq %>%
  mutate(group = events_to_actor_group, freq = events_to_actor_freq, dataset = "events_to_actor") %>%
  select(group, freq, dataset)

low_participation_summary <- bind_rows(
  low_participation_num_actors_freq, 
  low_participation_num_events_freq, 
  low_participation_events_to_actor_freq)

low_participation_summary_long <- melt(low_participation_summary)

ggplot(data = low_participation_summary_long, aes(x=group, y=value, fill=dataset))+
  geom_bar(stat="identity", position="dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  xlab("Events Per Actor") +
  ylab("Number of Projects") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

<h4>Medium Participation</h4>

Medium Participation projects had around 2-28 actors.

```{r}
med_participation_num_actors_freq <- readRDS("med_participation_num_actors_freq.rds")
med_participation_num_actors_freq <- med_participation_num_actors_freq %>%
  mutate(group = actors_group, freq = actor_freq, dataset = "actors") %>%
  select(group, freq, dataset)

med_participation_num_events_freq <- readRDS("med_participation_num_events_freq.rds")
med_participation_num_events_freq <- med_participation_num_events_freq %>%
  mutate(group = events_group, freq = events_freq, dataset = "events") %>%
  select(group, freq, dataset)

med_participation_events_to_actor_freq <- readRDS("med_participation_events_to_actor_freq.rds")
med_participation_events_to_actor_freq <- med_participation_events_to_actor_freq %>%
  mutate(group = events_to_actor_group, freq = events_to_actor_freq, dataset = "events_to_actor") %>%
  select(group, freq, dataset)

med_participation_summary <- bind_rows(
  med_participation_num_actors_freq, 
  med_participation_num_events_freq, 
  med_participation_events_to_actor_freq)

med_participation_summary_long <- melt(med_participation_summary)

ggplot(data = med_participation_summary_long, aes(x=group, y=value, fill=dataset))+
  geom_bar(stat="identity", position="dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  xlab("Events Per Actor") +
  ylab("Number of Projects") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

<h4>High Participation</h4>

High Participation projects had over 30 actors.

```{r}

high_participation_num_actors_freq <- readRDS("high_participation_num_actors_freq.rds")
high_participation_num_actors_freq <- high_participation_num_actors_freq %>%
  mutate(group = actors_group, freq = actor_freq, dataset = "actors") %>%
  select(group, freq, dataset)

high_participation_num_events_freq <- readRDS("high_participation_num_events_freq.rds")
high_participation_num_events_freq <- high_participation_num_events_freq %>%
  mutate(group = events_group, freq = events_freq, dataset = "events") %>%
  select(group, freq, dataset)

high_participation_events_to_actor_freq <- readRDS("high_participation_events_to_actor_freq.rds")
high_participation_events_to_actor_freq <- high_participation_events_to_actor_freq %>%
  mutate(group = events_to_actor_group, freq = events_to_actor_freq, dataset = "events_to_actor") %>%
  select(group, freq, dataset)

high_participation_summary <- bind_rows(
  high_participation_num_actors_freq, 
  high_participation_num_events_freq, 
  high_participation_events_to_actor_freq)

high_participation_summary_long <- melt(high_participation_summary)

ggplot(data = high_participation_summary_long, aes(x=group, y=value, fill=dataset))+
  geom_bar(stat="identity", position="dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  xlab("Events Per Actor") +
  ylab("Number of Projects") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```

<h4>Event Distribution Comparison</h4>

Looking at the raw data, just under 25% of GitHub events came from Low Participation (ie, 1 actor) projects that had only one event for the 6 month period studied. Medium Participation projects fall into the middle, suggesting further analysis that further divides the Medium level might be fruitful. We see the least variation in the number of events associated with High Participation projects.

```{r}
high_participation_num_events_freq <- high_participation_num_events_freq %>%
  mutate(participation_level="1:High")
med_participation_num_events_freq <- med_participation_num_events_freq %>%
  mutate(participation_level="2:Medium")
low_participation_num_events_freq <- low_participation_num_events_freq %>%
  mutate(participation_level="3:Low")

high_med_low_events_freq = bind_rows(high_participation_num_events_freq,
                                     med_participation_num_events_freq,
                                     low_participation_num_events_freq)

high_med_low_events_freq_long <- melt(high_med_low_events_freq)

ggplot(data = high_med_low_events_freq_long, aes(x=group, y=value, fill=participation_level))+
  geom_bar(stat="identity", position="dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  xlab("Events Per Actor") +
  ylab("Number of Projects") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
 
```



<h3>How do the number of actors, projects, and events compare in each participation level?</h3>

We see a very skewed distribution with low participation projects making up the majority of the event activity and high participation projects making up the minority.

<h4>Overall Events, Projects, and Actors</h4>

```{r}

participation_rate_summary <- readRDS("participation_rate_summary.rds")

participation_rate_summary$participation_level <- factor(participation_rate_summary$participation_level, 
  levels = unique(
    participation_rate_summary$participation_level[order(participation_rate_summary$num_repos, decreasing=TRUE)]))

participation_rate_summary_long <- melt(participation_rate_summary)

ggplot(data = participation_rate_summary_long, aes(x=factor(participation_level), y=value, fill=variable)) +
  geom_bar(stat="identity", position="dodge") +
  xlab("Participation Rate") +
  ylab("Count") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})

```


<h3>How much do the number of actors, projects, and events vary per over time in each participation grade?</h3>

<h4>Projects per Month</h4>
```{r}
participation_rate_per_month_summary <- readRDS("participation_rate_per_month_summary.rds")

participation_rate_per_month_summary$participation_level <- factor(participation_rate_per_month_summary$participation_level, 
  levels = unique(participation_rate_per_month_summary$participation_level[
    order(participation_rate_per_month_summary$num_repos, decreasing=TRUE)]))

ggplot(data = participation_rate_per_month_summary, 
       aes(x = factor(month, levels = month.abb), 
           y = num_events, 
           fill=participation_level,
           group=participation_level,
           color=participation_level)) +
  geom_line(stat="identity", position="identity") +
  geom_point() +
  ylab("Number of Events") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
```

<h4>Actors per Month</h4>
```{r}

ggplot(data = participation_rate_per_month_summary, 
       aes(x = factor(month, levels = month.abb), 
           y = num_actors, 
           fill=participation_level,
           group=participation_level,
           color=participation_level)) +
  geom_line(stat="identity", position="identity") +
  geom_point() +
  ylab("Number of Actors") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
```

<h4>Events per Month</h4>
```{r}

ggplot(data = participation_rate_per_month_summary, 
       aes(x = factor(month, levels = month.abb), 
           y = num_events, 
           fill=participation_level,
           group=participation_level,
           color=participation_level)) +
  geom_line(stat="identity", position="identity") +
  geom_point() +
  ylab("Number of Events") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
```

<h4>Average Events per Actor per Month</h4>
```{r}

ggplot(data = participation_rate_per_month_summary, 
       aes(x = factor(month, levels = month.abb), 
           y = total_events_per_actor, 
           fill=participation_level,
           group=participation_level,
           color=participation_level)) +
  geom_line(stat="identity", position="identity") +
  geom_point() +
  ylab("Ave Events per Actor") +
  xlab("Month") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})
```

<h3>How does the frequency of event types compare between participation rates?</h3>

```{r}
participation_rate_event_types <- readRDS("participation_rate_event_types.rds")

participation_rate_event_types$type <- 
  factor(participation_rate_event_types$type, 
         levels = unique(participation_rate_event_types$type[
           order(participation_rate_event_types$num_events, decreasing=TRUE)]))

participation_rate_event_types$participation_level <- 
  factor(participation_rate_event_types$participation_level, 
  levels = unique(participation_rate_event_types$participation_level[
    order(participation_rate_event_types$total_events_per_actor, decreasing=TRUE)]))

ggplot(data = participation_rate_event_types, 
       aes(x=type, 
       y=num_events, 
       fill=participation_level)) +
  geom_bar(stat="identity", position="dodge") + 
  ylab("Number of Events") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

```{r}
participation_rate_event_types_trimmed <- participation_rate_event_types %>% 
  filter(type == "PushEvent" |
           type == "CreateEvent" |
           type == "IssueCommentEvent" |
           type == "WatchEvent" |
           type == "PullRequestEvent" |
           type == "IssuesEvent" |
           type == "ForkEvent")

ggplot(data = participation_rate_event_types_trimmed, 
       aes(x=type, 
       y=num_events, 
       fill=participation_level)) +
  geom_bar(stat="identity", position="dodge") + 
  ylab("Number of Events") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

```{r}

ggplot(data = participation_rate_event_types, 
       aes(x=type, 
       y=num_actors, 
       fill=participation_level)) +
  geom_bar(stat="identity", position="dodge") + 
  ylab("Number of Actors") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

```{r}

ggplot(data = participation_rate_event_types_trimmed, 
       aes(x=type, 
       y=num_actors, 
       fill=participation_level)) +
  geom_bar(stat="identity", position="dodge") + 
  ylab("Number of Actors") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

TODO: This aggregation is weird and needs to be re-evaluated.

```{r}

ggplot(data = participation_rate_event_types, 
       aes(x=type, 
       y=total_events_per_actor, 
       fill=participation_level)) +
  geom_bar(stat="identity", position="dodge") + 
  ylab("Events per Actor") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

```{r}

ggplot(data = participation_rate_event_types_trimmed, 
       aes(x=type, 
       y=total_events_per_actor, 
       fill=participation_level)) +
  geom_bar(stat="identity", position="dodge") + 
  ylab("Events per Actor") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


<h2>Sampling Experiments</h2>

Given the above information, we should analyze the distributions of samples for the entire population and each strata. For sampling methodology, see the events_analysis_data.Rmd workbook in this repository.

<h3>Entire Population</h3>

Experiment 1: Distribution of 5 random samples of 100 github repos pulled from the entire population based on event data
TODO: Skipping due to MVP time contraints

```{r}

# TODO participation level

# TODO number of events, number of actors, events to actors

```

<h3>Participation Levels</h3>

Compare these to the total population for the given participation level. Proportions instead of total counts of events and actors are used to compare the shape of the distribution in the population to the shape of the distribution in the sample. The x-axis indicates what percent is represented by each variable, with a maximum value of 1 (or 100%).

Experiment 2: Distribution of 5 random samples for 100 high participation projects per above
TODO: Only checking 1 sample due to MVP time contraints

```{r}

participation_rate_event_types <- readRDS("participation_rate_event_types.rds")

high_participation_rate_event_types <- participation_rate_event_types %>%
  filter(participation_level == "High") %>%
  mutate(total_events = sum(num_events),
         total_actors = sum(num_actors),
         dataset = "population",
         events_prop = round(num_events/total_events,2),
         actors_prop = round(num_actors/total_actors,2))

high_participation_rate_event_types <- high_participation_rate_event_types %>%
  select(type, actors_prop, events_prop, total_events_per_actor, dataset)

high_sample1 <- readRDS("high_sample_1.rds")
high_sample1 <- high_sample1 %>% 
  mutate(dataset="sample1", 
         total_events = sum(num_events), 
         total_actors=sum(num_actors))

high_samples <- high_sample1 # for multiple samples: bind_rows(high_sample1, high_sample2)

high_sample_event_types <- high_samples %>%
  group_by(dataset, type) %>%
  summarise(
    sum_events = sum(num_events),
    sum_actors = sum(num_actors),
    total_events_per_actor = sum_events/sum_actors,
    events_prop = round(sum_events/min(total_events),2),
    actors_prop = round(sum_actors/min(total_actors),2)) %>%
  select(type, events_prop, actors_prop, total_events_per_actor, dataset)

high_participation_distribution <- bind_rows(high_sample_event_types, high_participation_rate_event_types)

high_participation_distribution$type <- factor(high_participation_distribution$type, 
  levels = unique(high_participation_distribution$type[order(high_participation_distribution$events_prop, decreasing=TRUE)]))

ggplot(data = high_participation_distribution, aes(x=type, y=events_prop, fill=dataset)) +
  geom_bar(stat="identity", position="dodge") +
  ylab("Events") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


```

```{r}
ggplot(data = high_participation_distribution, aes(x=type, y=actors_prop, fill=dataset)) +
  geom_bar(stat="identity", position="dodge") +
  ylab("Actors") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

TODO: To get an accurate count of number of actors, we need to get different data since events of different types could be associated with the same actor.

```{r}
high_summary_by_repo <- high_samples %>%
  group_by(repo_name) %>%
  summarise(
    total_repo_actors = round(sum(num_actors), -1),
    total_repo_events = round(sum(num_events), -1)
  )
  
high_summary_by_events <- high_summary_by_repo %>%
  group_by(total_repo_events) %>%
  summarise(num_repos = n())

ggplot(data = high_summary_by_events, aes(y=num_repos, x=factor(total_repo_events))) +
  geom_bar(stat="identity", position = "dodge") +
  ylab("Number of Repos") +
  xlab("Number of Events") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


```



Experiment 3: Distribution of 5 random samples for 100 medium participation projects per above
TODO: Only checking 1 sample due to MVP time contraints

```{r}

participation_rate_event_types <- readRDS("participation_rate_event_types.rds")

med_participation_rate_event_types <- participation_rate_event_types %>%
  filter(participation_level == "Medium") %>%
  mutate(total_events = sum(num_events),
         total_actors = sum(num_actors),
         dataset = "population",
         events_prop = round(num_events/total_events,2),
         actors_prop = round(num_actors/total_actors,2))

med_participation_rate_event_types <- med_participation_rate_event_types %>%
  select(type, actors_prop, events_prop, total_events_per_actor, dataset)

med_sample1 <- readRDS("med_sample_1.rds")
med_sample1 <- med_sample1 %>% 
  mutate(dataset="sample1", 
         total_events = sum(num_events), 
         total_actors=sum(num_actors))

med_samples <- med_sample1 # for multiple samples: bind_rows(med_sample1, med_sample2)

med_sample_event_types <- med_samples %>%
  group_by(dataset, type) %>%
  summarise(
    sum_events = sum(num_events),
    sum_actors = sum(num_actors),
    total_events_per_actor = sum_events/sum_actors,
    events_prop = round(sum_events/min(total_events),2),
    actors_prop = round(sum_actors/min(total_actors),2)) %>%
  select(type, events_prop, actors_prop, total_events_per_actor, dataset)

med_participation_distribution <- bind_rows(med_sample_event_types, med_participation_rate_event_types)

med_participation_distribution$type <- factor(med_participation_distribution$type, 
  levels = unique(med_participation_distribution$type[order(med_participation_distribution$events_prop, decreasing=TRUE)]))

ggplot(data = med_participation_distribution, aes(x=type, y=events_prop, fill=dataset)) +
  geom_bar(stat="identity", position="dodge") +
  ylab("Events") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
```{r}
ggplot(data = med_participation_distribution, aes(x=type, y=actors_prop, fill=dataset)) +
  geom_bar(stat="identity", position="dodge") +
  ylab("Actors") +
  xlab("Event Type") +
  scale_y_continuous(labels=function(n){format(n, scientific = FALSE)}) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

```{r}
med_summary_by_repo <- med_samples %>%
  group_by(repo_name) %>%
  summarise(
    total_repo_events = 5*round(sum(num_events)/5)
  )
med_summary_by_repo <- med_summary_by_repo %>%
  mutate(total_repo_events = ifelse(total_repo_events == 0, 1, total_repo_events))

med_summary_by_events <- med_summary_by_repo %>%
  group_by(total_repo_events) %>%
  summarise(num_repos = n())

ggplot(data = med_summary_by_events, aes(y=num_repos, x=factor(total_repo_events))) +
  geom_bar(stat="identity", position = "dodge") +
  ylab("Number of Repos") +
  xlab("Number of Events") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


Experiment 4: Distribution of 5 random samples for 100 low participation projects per above
TODO: Not checking this one due to time constraints and a problem with the samples

<h3>Specific Event Types</h3>

In this experiment, samples are pulled from 3 different event types that had the highest association with one participation level. We want to compare how the sample pulled for the event type matches the sample pulled for the participation level that had the most events of this type in the population.

Experiment 5: Distribution of 5 random samples for 100 Watch Events (High Participation)
TODO: Skipping due to MVP time contraints

```{r}
# TODO proportion of events, proportion of actors
```

Experiment 6: Distribution of 5 random samples for 100 Pull Request Events (Medium Participation)
TODO: Skipping due to MVP time contraints

```{r}
# TODO proportion of events, proportion of actors
```

Experiment 7: Distribution of 5 random samples for 100 Create Events (Low Participation)
TODO: Skipping due to MVP time contraints

```{r}
# TODO proportion of events, proportion of actors
```

Experiment 8: Distribution of 5 random samples for 100 Push Events (Low Participation)
TODO: Skipping due to MVP time contraints

```{r}
# TODO proportion of events, proportion of actors
```

<h2>Preliminary Conclusions</h2>

Given the incomplete state of the analysis, only preliminary conclusions can be made at this time.

<ol>
<li> At the macro scale, the proportions of different event types are consistent from month to month.</li>
<li> Samples from High and Medium participation projects did not significantly deviated from the overall population.</li>
<li> Based on the sample, the majority of Medium participation projects generated less than 20 events.</li>
<li> Based on the sample, the majority of High participation projects generated between 30 and 60 events.</li>
</ol>

For BonnyCI lead generation purposes, I will further examine the samples from high and medium participation projects using additional Github data in a future report.


